<?php
/**
 * Register the custom block style script.
 */
add_theme_support('editor-styles');
add_editor_style(get_template_directory_uri() . '/dist/editor.css');

add_action('enqueue_block_editor_assets', function () {
    wp_enqueue_script('flip-wptoolkit-theme-blocks-styles', get_template_directory_uri() . '/dist/blocks.js', array(
        'wp-blocks',
        'wp-dom-ready',
        'wp-edit-post'
    ), FLIP_WP_TOOLKIT_VER);
});

add_action('init', function () {
    $asset_file = require(get_template_directory() . '/compiled-blocks/custom-blocks.asset.php');

    wp_register_script(
        'flip-wptoolkit-theme-blocks',
        get_template_directory_uri() . '/compiled-blocks/custom-blocks.js',
        $asset_file['dependencies'],
        $asset_file['version']
    );

    $block_bootstrap = [
        'editor_script' => 'flip-wptoolkit-theme-blocks'
    ];

    $manifest = require(get_template_directory() . '/resources/assets/blocks/blocks-manifest.php');

    foreach ($manifest as $block) {
        register_block_type($block, $block_bootstrap);
    }
});

add_filter('block_categories', static function ($categories, $post) {
    return array_merge($categories, [
        [
            'slug' => 'flip-wptoolkit-theme-blocks',
            'title' => __('Theme Custom Blocks', 'flip-wptoolkit'),
            'icon' => '<svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M0 12.304C0 5.562 5.597.098 12.5.098S25 5.562 25 12.304c0 6.74-5.597 12.205-12.5 12.205S0 19.044 0 12.304zm18.633 2.178c.77-.033 1.508-.46 1.952-1.067.436-.597.58-1.405.29-2.093a1.86 1.86 0 0 0-.706-.838 2.394 2.394 0 0 0-1.04-.358 2.996 2.996 0 0 0-2.287.717c-.326.287-.57.642-.772 1.02-.093.172-.174.35-.261.525-.078.157-.16.314-.232.474-.158.347-.313.694-.469 1.043a4.145 4.145 0 0 0-1.355.421c.159-.454.344-.9.52-1.35.17-.433.317-.877.385-1.338.057-.373.087-.8-.113-1.14a.761.761 0 0 0-.444-.35 1.071 1.071 0 0 0-.604.026 1.85 1.85 0 0 0-.546.3 2.48 2.48 0 0 0-.456.442 3.018 3.018 0 0 0-.336.559c-.1.21-.18.429-.241.654a5.702 5.702 0 0 0-.105.464c.121-.4.265-.789.495-1.141.21-.326.491-.644.87-.785a.58.58 0 0 1 .57.072.647.647 0 0 1 .243.515c.003.223-.067.447-.128.66a9.82 9.82 0 0 1-.223.677c-.165.453-.351.896-.537 1.34-.185.446-.379.888-.591 1.323-.13.268-.262.536-.395.803l-.2.396a3.787 3.787 0 0 1-.211.378c.244.022.488.07.734.048.096-.009.19-.038.25-.117.066-.086.108-.19.155-.286.19-.397.425-.778.714-1.113.366-.426.812-.785 1.342-1-.426.865-.785 1.756-1.182 2.63-.187.41-.385.818-.65 1.185a2.31 2.31 0 0 1-.42.454 2.146 2.146 0 0 1-.519.303c-.38.156-.815.2-1.207.052-.4-.15-.696-.496-.783-.905-.088-.42.002-.877.203-1.253.202-.378.53-.645.879-.889l.124-.086c-.21.093-.428.195-.612.332-.173.127-.32.29-.443.464a2.563 2.563 0 0 0-.458 1.394c-.01.42.098.845.336 1.197.218.322.55.567.929.679.79.23 1.647-.088 2.242-.605.328-.285.579-.64.79-1.015.232-.41.426-.841.62-1.27.2-.447.398-.894.594-1.341.195-.445.377-.895.57-1.341l.125-.279c.247-.022.496-.014.743.003.123.009.246.02.369.034.1.01.21.012.307.047.048.017.086.045.128.071.045.03.093.056.141.08.093.045.19.081.289.11.2.055.41.075.617.068zm-.376-3.653a1.663 1.663 0 0 1 1.237.073c.345.171.607.485.719.846.123.402.038.84-.157 1.206a1.904 1.904 0 0 1-.836.804c-.371.184-.819.265-1.229.171a1.157 1.157 0 0 1-.534-.268 1.06 1.06 0 0 1-.295-.529c-.025-.1-.04-.204-.052-.306a1.346 1.346 0 0 1-.006-.34c-.016.005-.02.07-.023.083-.01.052-.023.105-.034.157a2.22 2.22 0 0 0-.06.41c-.003.133.005.27.047.398.04.127.112.24.177.356a8.81 8.81 0 0 0-1.091-.061c.07-.203.163-.398.247-.596.078-.182.156-.364.23-.547a5.49 5.49 0 0 1 .316-.607c.114-.185.244-.359.389-.523.134-.154.28-.3.443-.43a1.67 1.67 0 0 1 .512-.297zm-7.602 4.8c.2-.077.22-.361.217-.54l-.001-.039a.409.409 0 0 1-.039-.008l-.076-.015a1.518 1.518 0 0 0-.158-.02.659.659 0 0 0-.32.048l-.024.014a.481.481 0 0 0-.128.237c-.02.083-.037.179-.035.264.001.044.026.06.067.066.054.005.106.013.16.021a.69.69 0 0 0 .337-.028zm4.254-6.593c-.001-.044-.026-.06-.067-.065l-.16-.02a.682.682 0 0 0-.337.027c-.2.077-.219.362-.216.54v.038l.039.008c.025.006.05.01.076.015a1.2 1.2 0 0 0 .158.02c.11.008.22-.002.32-.047l.025-.015a.47.47 0 0 0 .126-.237c.02-.082.038-.177.036-.264zM8.93 12.743c.093-.172.174-.35.26-.524.079-.158.159-.315.232-.475.158-.346.314-.694.47-1.042a4.171 4.171 0 0 0 1.355-.422c-.158.455-.345.9-.52 1.35-.17.434-.317.878-.385 1.339-.057.372-.087.799.113 1.139.1.167.253.298.445.352.191.054.415.034.603-.027.198-.062.381-.176.546-.3a2.45 2.45 0 0 0 .456-.443 3.07 3.07 0 0 0 .335-.558c.102-.211.18-.43.242-.654.042-.153.076-.308.105-.464-.121.398-.265.788-.494 1.141-.211.325-.492.644-.871.784a.578.578 0 0 1-.57-.071.644.644 0 0 1-.243-.516c-.003-.223.067-.447.127-.66.066-.229.143-.454.224-.677.165-.453.351-.896.537-1.34.186-.446.38-.888.591-1.323.13-.267.263-.535.395-.803l.2-.396c.065-.128.132-.257.212-.378-.244-.022-.489-.07-.735-.047-.096.008-.19.038-.25.116-.066.087-.108.19-.154.287a5.08 5.08 0 0 1-.715 1.114c-.366.425-.813.784-1.342.998.426-.863.786-1.755 1.182-2.63.187-.41.384-.818.65-1.185.121-.167.256-.322.42-.453.157-.125.332-.227.518-.303.381-.155.816-.2 1.208-.052.4.15.696.496.783.906.088.419-.002.876-.203 1.252-.202.378-.53.645-.879.888l-.124.086c.21-.093.428-.195.612-.33.173-.128.32-.291.443-.466a2.548 2.548 0 0 0 .458-1.394 2.056 2.056 0 0 0-.336-1.196 1.709 1.709 0 0 0-.929-.678c-.79-.231-1.647.087-2.242.604-.328.285-.58.64-.79 1.014-.231.411-.427.841-.62 1.272-.2.445-.398.892-.594 1.34-.194.445-.377.895-.571 1.34l-.123.28a4.533 4.533 0 0 1-.744-.003c-.123-.01-.246-.02-.369-.034-.102-.01-.21-.013-.307-.047-.048-.018-.086-.046-.128-.072a1.5 1.5 0 0 0-.43-.188 2.04 2.04 0 0 0-.617-.07c-.77.034-1.508.46-1.952 1.068-.437.597-.58 1.404-.29 2.092.142.342.391.633.707.839.31.201.671.317 1.04.359a3.003 3.003 0 0 0 2.286-.718c.325-.288.57-.643.772-1.02zm-.917-1.272a1.187 1.187 0 0 0-.047-.399c-.04-.126-.112-.24-.177-.355.362.045.727.06 1.091.06-.07.203-.163.398-.247.596-.078.183-.156.364-.23.547a5.362 5.362 0 0 1-.316.607c-.114.185-.245.36-.389.524-.134.154-.28.3-.443.43a1.687 1.687 0 0 1-.512.297 1.658 1.658 0 0 1-1.237-.074 1.411 1.411 0 0 1-.719-.846c-.123-.402-.038-.84.157-1.205a1.9 1.9 0 0 1 .836-.805c.371-.184.819-.265 1.228-.171.198.045.387.132.535.27.153.142.245.328.295.527.025.1.04.204.05.307.013.112.025.227.008.34.016-.005.02-.07.023-.083.009-.053.023-.105.035-.157.031-.136.053-.271.059-.41z"></path>
        </svg>,'
        ]
    ]);
}, 10, 2);